{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ document.title }} | Book AI Tutor</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .sidebar {
            height: 100vh;
            position: sticky;
            top: 0;
            background-color: #f8f9fa;
            padding: 20px;
            overflow-y: auto;
        }
        
        .content-area {
            padding: 20px;
            min-height: 100vh;
        }
        
        .chapter-title {
            font-weight: bold;
            margin-top: 20px;
            cursor: pointer;
        }
        
        .section-title {
            margin-left: 20px;
            cursor: pointer;
        }
        
        .content-block {
            margin-bottom: 30px;
        }
        
        .content-text {
            white-space: pre-line;
            font-size: 1rem;
        }
        
        .content-image {
            max-width: 100%;
            margin: 20px 0;
        }
        
        .table-content {
            margin: 20px 0;
        }
        
        code {
            display: block;
            background-color: #f1f1f1;
            padding: 10px;
            border-radius: 5px;
        }
        
        .math-formula {
            text-align: center;
            margin: 20px 0;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar with Table of Contents -->
            <div class="col-md-3 col-lg-2 sidebar">
                <h2 class="mt-2 mb-4">{{ document.title }}</h2>
                <h5 class="mb-3">Table of Contents</h5>
                <div id="toc">
                    {% for chapter in document.chapters.all %}
                        <div class="chapter-item">
                            <div class="chapter-title" data-chapter="{{ chapter.id }}">
                                {{ chapter.number }}. {{ chapter.title }}
                            </div>
                            <div class="sections" id="chapter-{{ chapter.id }}-sections">
                                {% for section in chapter.sections.all %}
                                    <div class="section-title" data-section="{{ section.id }}">
                                        {{ chapter.number }}.{{ section.number }} {{ section.title }}
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
            
            <!-- Main Content Area -->
            <div class="col-md-9 col-lg-10 content-area">
                <div class="content-header">
                    <h1>{{ document.title }}</h1>
                    {% if document.author %}
                        <h5>By {{ document.author }}</h5>
                    {% endif %}
                    {% if document.description %}
                        <p class="mb-4">{{ document.description }}</p>
                    {% endif %}
                </div>
                
                <div class="document-content">
                    {% for chapter in document.chapters.all %}
                        <div class="content-chapter" id="chapter-{{ chapter.id }}">
                            <h2 class="mb-3">{{ chapter.number }}. {{ chapter.title }}</h2>
                            
                            <!-- Direct chapter content (no section) -->
                            {% for content in chapter.direct_contents.all %}
                                <div class="content-block">
                                    {% if content.content_type == 'text' %}
                                        <div class="content-text">{{ content.text_content }}</div>
                                    {% elif content.content_type == 'image' %}
                                        <div class="content-image">
                                            <img src="{{ content.image.url }}" class="img-fluid" alt="Image from PDF">
                                        </div>
                                    {% elif content.content_type == 'table' %}
                                        <div class="table-content">
                                            {{ content.text_content|safe }}
                                        </div>
                                    {% elif content.content_type == 'code' %}
                                        <code>{{ content.text_content }}</code>
                                    {% elif content.content_type == 'formula' %}
                                        <div class="math-formula">{{ content.text_content }}</div>
                                    {% endif %}
                                </div>
                            {% endfor %}
                            
                            <!-- Section content -->
                            {% for section in chapter.sections.all %}
                                <div class="content-section" id="section-{{ section.id }}">
                                    <h3 class="mt-4 mb-3">{{ chapter.number }}.{{ section.number }} {{ section.title }}</h3>
                                    
                                    {% for content in section.contents.all %}
                                        <div class="content-block">
                                            {% if content.content_type == 'text' %}
                                                <div class="content-text">{{ content.text_content }}</div>
                                            {% elif content.content_type == 'image' %}
                                                <div class="content-image">
                                                    <img src="{{ content.image.url }}" class="img-fluid" alt="Image from PDF">
                                                </div>
                                            {% elif content.content_type == 'table' %}
                                                <div class="table-content">
                                                    {{ content.text_content|safe }}
                                                </div>
                                            {% elif content.content_type == 'code' %}
                                                <code>{{ content.text_content }}</code>
                                            {% elif content.content_type == 'formula' %}
                                                <div class="math-formula">{{ content.text_content }}</div>
                                            {% endif %}
                                        </div>
                                    {% endfor %}
                                </div>
                            {% endfor %}
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Client-side navigation for the table of contents
        document.addEventListener('DOMContentLoaded', function() {
            const chapterTitles = document.querySelectorAll('.chapter-title');
            const sectionTitles = document.querySelectorAll('.section-title');
            
            // Handle chapter navigation
            chapterTitles.forEach(function(title) {
                title.addEventListener('click', function() {
                    const chapterId = this.getAttribute('data-chapter');
                    const chapterElement = document.getElementById(`chapter-${chapterId}`);
                    
                    if (chapterElement) {
                        chapterElement.scrollIntoView({ behavior: 'smooth' });
                    }
                });
            });
            
            // Handle section navigation
            sectionTitles.forEach(function(title) {
                title.addEventListener('click', function() {
                    const sectionId = this.getAttribute('data-section');
                    const sectionElement = document.getElementById(`section-${sectionId}`);
                    
                    if (sectionElement) {
                        sectionElement.scrollIntoView({ behavior: 'smooth' });
                    }
                });
            });
        });
    </script>
</body>
</html>
